jQuery.tabsView=function(config){this.setting={root:null,tabs:null,contents:null,hash:false,defaultIndex:0,isFirstView:true,defaultData:'',lastIndex:0,hideAll:false,lastTab:null,lastContent:null,timer:null,auto:null,scroll:null,evtType:'click',ajax:null};jQuery.extend(this.setting,config);this.init();return this;};jQuery.tabsView.prototype={init:function(){var tabsView=this,setting=this.setting,root=$(setting.root),tabs=null,contents=null,hashIndex=-1,defaultIndex=0,lastIndex=setting.lastIndex,isAuto=setting.auto,isAjax=setting.ajax,isScroll=setting.scroll;if(root){tabs=setting.tabs=root.find(setting.tabs).length>0?root.find(setting.tabs):root.find('li');contents=setting.contents=root.find(setting.contents).length>0?root.find(setting.contents):root.find('.tabs-post');}else{tabs=$(setting.tabs);contents=$(setting.contents);}if(setting.hash){hashIndex=this.getHashIndex();}defaultIndex=setting.defaultIndex=hashIndex>-1?hashIndex:setting.defaultIndex;setting.lastTab=$(tabs[lastIndex]);if(isAjax){setting.lastContent=$(contents[0]);isAjax.cacheData=[];setting.defaultData=contents[0].innerHTML;if(defaultIndex===lastIndex){isAjax.cacheData[defaultIndex]=setting.defaultData;}}else{setting.lastContent=$(contents[setting.lastIndex]);}if(isScroll){isScroll.itemHeight=$(contents[0]).height();isScroll.itemWidth=$(contents[0]).width();}if(setting.hideAll){this.bind();}else{this.setCurrent(defaultIndex).bind();}if(isAuto){setting.timer=setTimeout(function(){tabsView.autoChange.call(tabsView);},isAuto.speed);}return this;},bind:function(){var tabsView=this,setting=this.setting,contents=setting.contents,isAuto=setting.auto,isHideAll=setting.hideAll,evtType=setting.evtType;setting.tabs.each(function(i,tab){if(tab.tagName.toLowerCase()==='a'){$(tab).focusin(function(evt){tabsView.setCurrent(i);evt.preventDefault();evt.stopPropagation();});}else{if(tab.tagName.toLowerCase()==='li'){$($(tab).find('a')[0]).focusin(function(evt){tabsView.setCurrent(i);evt.preventDefault();evt.stopPropagation();});}}$(tab)[evtType](function(evt){if(isHideAll){if(evtType.toLowerCase()==='mouseover'){tabsView.setCurrent(i);}}else{if(i!==setting.lastIndex){tabsView.setCurrent(i);}}evt.preventDefault();evt.stopPropagation();});if(isAuto){$(tab).mouseover(function(){if(setting.timer){clearTimeout(setting.timer);setting.timer=null;}});$(tab).mouseout(function(evt){setting.timer=setTimeout(function(){tabsView.autoChange.call(tabsView);},isAuto.speed/2);});$(contents[i]).mouseover(function(evt){if(setting.timer){clearTimeout(setting.timer);setting.timer=null;}});$(contents[i]).mouseout(function(evt){setting.timer=setTimeout(function(){tabsView.autoChange.call(tabsView);},isAuto.speed/2);});}else{if(isHideAll){$(tab).mouseout(function(evt){$(tab).removeClass('current');$(setting.contents[i]).addClass('hide');});}}});return this;},setCurrent:function(tabIndex){var setting=this.setting,tabs=setting.tabs,contents=setting.contents,curTab=$(tabs[tabIndex]),curContent=$(contents[tabIndex]),isAjax=setting.ajax,isScroll=setting.scroll,isFade=setting.fade,opacityVal=1,timer=null,fadeIn=function(){if(timer){clearTimeout(timer);timer=null;}opacityVal-=0.05;if(opacityVal<0.5){showCurContent();$(setting.lastContent).css('opacity',1);return false;}$(setting.lastContent).css('opacity',opacityVal);timer=setTimeout(fadeIn,isFade.speed);},showCurContent=function(){$(setting.lastContent).addClass('hide');curContent.removeClass('hide');setting.lastContent=curContent;},direction='',isCycle=false;$(setting.lastTab).removeClass('current');curTab.addClass('current');if(isScroll){direction=(isScroll.direction||$(isScroll.body).attr('id').split('-')[1])||'h';isCycle=(isScroll.cycle||$(isScroll.body).attr('id').split('-')[2]==='cycle')||false;if(direction.toUpperCase()==='H'){if(isCycle){if(setting.isFirstView){curContent.css({'z-index':4});}else{$(setting.lastContent).css({'z-index':4,'top':0}).animate({top:-isScroll.itemHeight});curContent.css({'z-index':4,'top':isScroll.itemHeight+'px'}).animate({'top':0});}setting.lastContent=curContent;}else{$(isScroll.body).animate({'top':-(tabIndex*isScroll.itemHeight)});}}else{if(isCycle){if(setting.isFirstView){curContent.css({'z-index':4,'left':0});}else{$(setting.lastContent).css({'z-index':4,'left':0}).animate({left:-isScroll.itemWidth});curContent.css({'z-index':4,'left':isScroll.itemWidth+'px'}).animate({'left':0});}setting.lastContent=curContent;}else{$(isScroll.body).css('width',(tabs.length*isScroll.itemWidth)+'px').animate({'left':-(tabIndex*isScroll.itemWidth)});}}}else{if(isAjax){this.ajaxInject(tabIndex);}else{if(isFade&&!setting.isFirstView){timer=setTimeout(fadeIn,isFade.speed);}else{showCurContent();}}}setting.isFirstView=false;setting.lastIndex=tabIndex;setting.lastTab=curTab;return this;},getURIHash:function(){var url=location.href,tabURIHash='';if(url.indexOf('#')>-1){tabURIHash=url.split('#')[1];}else{if(url.indexOf('tab=')>-1){tabURIHash=url.split('tab=')[1];if(tabURIHash.indexOf('&')>=1){tabURIHash=tabURIHash.split('&')[0];}}}return tabURIHash;},getHashIndex:function(){var tabs=this.setting.tabs,tabURIHash=this.getURIHash(),tabIndex=-1;if(tabURIHash){tabs.each(function(i,tab){var links=$(tab).find('a');if($(tab).attr('id')===tabURIHash){tabIndex=i;}else{if(links.length>0){if($(links[0]).attr('rel')===tabURIHash){tabIndex=i;}}}});}return tabIndex;},ajaxInject:function(tabIndex){var tabsView=this,setting=this.setting,tabs=setting.tabs,content=setting.lastContent,curTab=$(tabs[tabIndex]),filename=curTab.attr('id')||$(curTab.find('a')[0]).attr('rel'),ajax=setting.ajax,dataType=ajax.dataType.toLowerCase(),extName=dataType==='json'?'js':dataType,path=ajax.dataPath+'/'+filename+'.'+extName;if(!ajax.cacheData[tabIndex]){$.ajax({url:path,method:'GET',dataType:ajax.dataType,cache:true,success:function(jqXHR){var data=jqXHR.html;content.html(data);ajax.cacheData[tabIndex]=data;},error:function(jqXHR,textStatus,errorThrown){alert(errorThrown);}});}else{content.html(ajax.cacheData[tabIndex]);}},autoChange:function(){var tabsView=this,setting=this.setting,speed=setting.auto.speed||4000,tabs=setting.tabs,len=tabs.length;setting.lastIndex+=1;if(setting.timer){clearTimeout(setting.timer);setting.timer=null;}if(setting.lastIndex>=len){setting.lastIndex=0;}this.setCurrent(setting.lastIndex);setting.timer=setTimeout(function(){tabsView.autoChange.call(tabsView);},speed);return this;},getDefaultIndex:function(){return this.setting.defaultIndex;},getDefaultData:function(){return this.setting.defaultData;},getLastIndex:function(){return this.setting.lastIndex;},getAjaxCache:function(){return this.setting.ajax.cacheData||[];}};jQuery.tabs=function(){var tabs=[],i=0,len=arguments.length;for(;i<len;i+=1){tabs[i]=new jQuery.tabsView(arguments[i]);}return tabs;};